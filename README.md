# ELF-Malware-Analysis-Seattle-2023

## Setup

### Local VM Option
1. Download and install your favourite hypervisor. Virtualbox is free.
2. Follow the instructions here to set up a standard remnux VM (won't run on Apple M1 or M2; If that is you, go to the cloud option) https://docs.remnux.org/install-distro/get-virtual-appliance
3. Change network settings to 'host-only'/follow the method to isolate your VM based on the hypervisor you choose.
4. Download workshop files from here:
     * [Link](https://storage.googleapis.com/wshp-jun-2023-samples/wshp-jun-2023-samples.tar.gz)
     * Gstutil URI: gs://wshp-jun-2023-samples/wshp-jun-2023-samples.tar.gz
6. Take a snapshot and call it "clean".

### Cloud VM Option
1. Create a free GCP account.
    * Note on cost: If this is the first time you're creating this, you will have a bunch of free credits. If not, the VM below will cost you about 4-6 cents/hr.
2. Run the commands here in a gcp cloud shell: https://raw.githubusercontent.com/blackhoodieRE/ELF-Malware-Analysis-Seattle-2023/main/gcp-cloudshell-commands?token=GHSAT0AAAAAACDF56FDWO3IDN2PFH5QSL5EZDVM6CA
    * If this is a new account, the commandline will prompt you to enable google apis, agree to that. If this is an pre-existing account, you may have to enable the compute enginer and/or billing.
4. Once completed successfully, go to the Compute Engine in the GCP console. There should be a new VM there.
5. SSH into it (click on ssh button-- google sets up ssh keys etc for free) and check startup script installation with `sudo journalctl -u google-startup-scripts.service| tail`. After 2-3 minutes, it should finish with `Finished Google Compute Engine Startup Scripts` message.
6. Once the start up script is done, start and fix VNC server
    * Start a new server with `vncserver` (enter any password you like) and then kill it with `vncserver -kill :1`
    * `cp /tmp/xstartup .vnc/xstartup`
    * Then start a new vncserver with `vncserver -rfbport 3582 -geometry 1920x1080`
7. Isolate the VM. Click on the 3-dot icon next to the VM and go to "Network Details" and create these firewall rules.
    * Create 2 egress rules --to deny outbound on all IPv4 (0.0.0.0/0) and IPv6 (::/0) addresses
    * Create an ingress allow rule to allow your VNC connection. Allow tcp on port 3582
8. Install a VNC client on your local machine and try connecting to the cloud VM. (I used RealVNC. Just click cancel if it asks you sign up.)
9. Create a Machine Image (https://cloud.google.com/compute/docs/machine-images/create-machine-images) of your VM. This is your "Clean" snapshot.

Tip: if you have an ARM machine (M1/M2 Mac) local VMs are finicky. Hypervisor support isn't great either. That is why I am recommending a cloud VM. If you do get a working set up locally for M1/2, I will ask you to share it :).
